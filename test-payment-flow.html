<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Payment Flow - Yadav Bangles Store</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #FF6B35;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #e55a2b;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Payment Flow Test</h1>
        <p>This page will test if your payment integration is working correctly.</p>
        
        <div class="status info">
            <strong>Test Status:</strong> <span id="testStatus">Ready to test...</span>
        </div>
        
        <h3>Quick Tests:</h3>
        <button class="test-button" onclick="testSubmitOrderFunction()">
            üîç Test submitOrder Function
        </button>
        
        <button class="test-button" onclick="testPaymentOptionsModal()">
            üí≥ Test Payment Options Modal
        </button>
        
        <button class="test-button" onclick="testUPIPayment()">
            üì± Test UPI Payment Flow
        </button>
        
        <button class="test-button" onclick="simulateFullOrder()">
            üõçÔ∏è Simulate Full Order Flow
        </button>
        
        <button class="test-button" onclick="clearLogs()">
            üßπ Clear Logs
        </button>
        
        <h3>Debug Console:</h3>
        <div class="debug-log" id="debugLog">Console logs will appear here...</div>
        
        <h3>Instructions:</h3>
        <ol>
            <li><strong>Test submitOrder Function:</strong> Checks if the new payment function is loaded</li>
            <li><strong>Test Payment Options Modal:</strong> Shows the payment selection screen</li>
            <li><strong>Test UPI Payment:</strong> Tests UPI payment flow with your UPI ID</li>
            <li><strong>Simulate Full Order:</strong> Complete end-to-end test</li>
        </ol>
        
        <div class="status info">
            <strong>Expected Result:</strong> You should see payment options (Paytm, UPI, etc.) instead of direct WhatsApp redirect.
        </div>
    </div>
    
    <!-- Include your payment configuration and main scripts -->
    <script src="payment-config.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        // Override console.log to capture logs
        const originalConsoleLog = console.log;
        const debugLog = document.getElementById('debugLog');
        const testStatus = document.getElementById('testStatus');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const logMessage = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : arg
            ).join(' ');
            debugLog.textContent += new Date().toLocaleTimeString() + ': ' + logMessage + '\n';
            debugLog.scrollTop = debugLog.scrollHeight;
        };
        
        function updateStatus(message, type = 'info') {
            testStatus.textContent = message;
            testStatus.parentElement.className = `status ${type}`;
        }
        
        function testSubmitOrderFunction() {
            console.log('üîç Testing submitOrder function...');
            updateStatus('Testing submitOrder function...', 'info');
            
            try {
                if (typeof submitOrder === 'function') {
                    console.log('‚úÖ submitOrder function exists');
                    
                    // Check if it's the new version by looking for payment options
                    const functionString = submitOrder.toString();
                    if (functionString.includes('showPaymentOptions')) {
                        console.log('‚úÖ NEW submitOrder function detected (with payment options)');
                        updateStatus('‚úÖ NEW submitOrder function is loaded correctly!', 'success');
                    } else {
                        console.log('‚ùå OLD submitOrder function detected (WhatsApp only)');
                        updateStatus('‚ùå OLD submitOrder function detected - check for conflicts', 'error');
                    }
                } else {
                    console.log('‚ùå submitOrder function not found');
                    updateStatus('‚ùå submitOrder function not found', 'error');
                }
            } catch (error) {
                console.log('‚ùå Error testing submitOrder:', error);
                updateStatus('‚ùå Error testing submitOrder function', 'error');
            }
        }
        
        function testPaymentOptionsModal() {
            console.log('üí≥ Testing payment options modal...');
            updateStatus('Testing payment options modal...', 'info');
            
            try {
                if (typeof showPaymentOptions === 'function') {
                    console.log('‚úÖ showPaymentOptions function exists');
                    
                    // Create test order data
                    const testOrderData = {
                        customerName: 'Test Customer',
                        customerPhone: '9999999999',
                        customerAddress: 'Test Address, Aligarh',
                        productName: 'Test Golden Bangles',
                        quantity: '2',
                        specialRequests: 'Test order'
                    };
                    
                    // Test the function
                    showPaymentOptions(testOrderData, 500);
                    updateStatus('‚úÖ Payment options modal should be visible now!', 'success');
                } else {
                    console.log('‚ùå showPaymentOptions function not found');
                    updateStatus('‚ùå showPaymentOptions function not found', 'error');
                }
            } catch (error) {
                console.log('‚ùå Error testing payment options:', error);
                updateStatus('‚ùå Error testing payment options modal', 'error');
            }
        }
        
        function testUPIPayment() {
            console.log('üì± Testing UPI payment flow...');
            updateStatus('Testing UPI payment flow...', 'info');
            
            try {
                // Create test order and store in session
                const testOrderData = {
                    customerName: 'Test Customer',
                    customerPhone: '9999999999',
                    customerAddress: 'Test Address, Aligarh',
                    productName: 'Test Golden Bangles',
                    quantity: '2',
                    total: 500,
                    orderId: 'TEST' + Date.now()
                };
                
                sessionStorage.setItem('pendingOrder', JSON.stringify(testOrderData));
                
                if (typeof initiateUPIPayment === 'function') {
                    console.log('‚úÖ initiateUPIPayment function exists');
                    initiateUPIPayment();
                    updateStatus('‚úÖ UPI payment screen should be visible now!', 'success');
                } else {
                    console.log('‚ùå initiateUPIPayment function not found');
                    updateStatus('‚ùå initiateUPIPayment function not found', 'error');
                }
            } catch (error) {
                console.log('‚ùå Error testing UPI payment:', error);
                updateStatus('‚ùå Error testing UPI payment flow', 'error');
            }
        }
        
        function simulateFullOrder() {
            console.log('üõçÔ∏è Simulating full order flow...');
            updateStatus('Simulating full order flow...', 'info');
            
            try {
                // Create a mock form event
                const mockForm = document.createElement('form');
                mockForm.innerHTML = `
                    <input name="customerName" value="Test Customer">
                    <input name="customerPhone" value="9999999999">
                    <input name="customerAddress" value="Test Address, Aligarh">
                    <input name="productName" value="Test Golden Bangles">
                    <input name="quantity" value="2">
                    <input name="specialRequests" value="Test order">
                    <button type="submit">Submit</button>
                `;
                
                const mockEvent = {
                    preventDefault: () => {},
                    target: mockForm
                };
                
                // Test the full flow
                console.log('üöÄ Calling submitOrder with mock data...');
                submitOrder(mockEvent);
                
                setTimeout(() => {
                    updateStatus('‚úÖ Full order simulation completed! Check for payment options.', 'success');
                }, 1500);
                
            } catch (error) {
                console.log('‚ùå Error simulating full order:', error);
                updateStatus('‚ùå Error simulating full order flow', 'error');
            }
        }
        
        function clearLogs() {
            debugLog.textContent = 'Console cleared...\n';
            updateStatus('Logs cleared. Ready for new tests.', 'info');
        }
        
        // Initialize
        console.log('üß™ Payment Flow Test Page Loaded');
        console.log('üìä Checking configuration...');
        
        if (window.PAYMENT_GATEWAYS) {
            console.log('‚úÖ External payment configuration loaded');
        } else {
            console.log('‚ö†Ô∏è External payment configuration not found, using defaults');
        }
        
        // Auto-run basic test
        setTimeout(() => {
            testSubmitOrderFunction();
        }, 1000);
    </script>
</body>
</html> 